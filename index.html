<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Site</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .question { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    .hidden { display: none; }
    .lang { float: right; }
    .pagination { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Quiz Site <span class="lang">
    Language:
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="ta">தமிழ்</option>
    </select>
  </span></h1>

  <!-- Topic and Subtopic Selectors -->
  <label for="topicSelect">Topic:</label>
  <select id="topicSelect"></select>

  <label for="subtopicSelect">Subtopic:</label>
  <select id="subtopicSelect"></select>

  <label>Time (minutes):</label>
  <input id="timeLimit" type="number" value="2" min="1" max="30">

  <button onclick="generateQuiz()">Start Quiz</button>

  <div id="timer" style="font-weight: bold; margin-top: 10px;"></div>

  <!-- Quiz Container -->
  <div id="quizContainer" class="hidden"></div>

  <div class="pagination hidden">
    <button onclick="prevQuestion()">Previous</button>
    <button onclick="nextQuestion()">Next</button>
    <button onclick="submitQuiz()">Submit</button>
  </div>

  <div id="scoreContainer"></div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vXYZ/pub?output=csv"; // Replace with yours
    let quizData = [];
    let currentLang = "en";
    let currentQ = 0;
    let currentSet = [];
    let timerInterval;

    fetch(sheetURL)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").map(r => r.split(","));
        const headers = rows[0];
        quizData = rows.slice(1).map(row => {
          let obj = {};
          headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
          return obj;
        });
        populateTopics();
      });

    document.getElementById("languageSelect").addEventListener("change", e => {
      currentLang = e.target.value;
      generateQuiz(); // Reload content in selected language
    });

    function populateTopics() {
      const topicSelect = document.getElementById("topicSelect");
      const topics = new Set(quizData.map(q => q.Topic));
      topics.forEach(topic => {
        const opt = document.createElement("option");
        opt.value = topic;
        opt.textContent = topic;
        topicSelect.appendChild(opt);
      });
      topicSelect.addEventListener("change", populateSubtopics);
      populateSubtopics();
    }

    function populateSubtopics() {
      const topic = document.getElementById("topicSelect").value;
      const subSelect = document.getElementById("subtopicSelect");
      subSelect.innerHTML = "";
      const subtopics = new Set(quizData.filter(q => q.Topic === topic).map(q => q.Subtopic));
      subtopics.forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subSelect.appendChild(opt);
      });
    }

    function generateQuiz() {
      const topic = document.getElementById("topicSelect").value;
      const subtopic = document.getElementById("subtopicSelect").value;
      currentSet = quizData.filter(q => q.Topic === topic && q.Subtopic === subtopic);

      if (currentSet.length === 0) return alert("No questions found!");

      currentQ = 0;
      showQuestion();
      document.querySelector(".pagination").classList.remove("hidden");
      document.getElementById("quizContainer").classList.remove("hidden");

      // Start Timer
      const mins = parseInt(document.getElementById("timeLimit").value);
      startTimer(mins * 60);
    }

    function showQuestion() {
      const q = currentSet[currentQ];
      const lang = currentLang;
      const div = document.getElementById("quizContainer");
      div.innerHTML = `
        <div class="question">
          <p><strong>Q${currentQ + 1}: ${q[`Question_${lang}`]}</strong></p>
          <label><input type="radio" name="q" value="A"> A. ${q[`OptionA_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="B"> B. ${q[`OptionB_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="C"> C. ${q[`OptionC_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="D"> D. ${q[`OptionD_${lang}`]}</label><br>
          <div class="explanation hidden" id="exp"><em>${q[`Explanation_${lang}`]}</em></div>
        </div>
      `;
    }

    function nextQuestion() {
      if (currentQ < currentSet.length - 1) {
        saveAnswer();
        currentQ++;
        showQuestion();
      }
    }

    function prevQuestion() {
      if (currentQ > 0) {
        saveAnswer();
        currentQ--;
        showQuestion();
      }
    }

    const answers = {};

    function saveAnswer() {
      const selected = document.querySelector(`input[name="q"]:checked`);
      if (selected) answers[currentQ] = selected.value;
    }

    function submitQuiz() {
      saveAnswer();
      clearInterval(timerInterval);
      let score = 0;
      currentSet.forEach((q, i) => {
        if (answers[i] === q.Answer) score++;
      });
      const total = currentSet.length;
      document.getElementById("scoreContainer").innerHTML =
        `<h3>Score: ${score} / ${total}</h3>`;
      showExplanations();
    }

    function showExplanations() {
      const div = document.getElementById("quizContainer");
      div.innerHTML = "";
      currentSet.forEach((q, i) => {
        const lang = currentLang;
        const userAns = answers[i] || "Not Answered";
        const correct = q.Answer;
        const color = userAns === correct ? "#c8e6c9" : "#ffcdd2";
        div.innerHTML += `
          <div class="question" style="background-color:${color};">
            <p><strong>Q${i + 1}: ${q[`Question_${lang}`]}</strong></p>
            <p>Your answer: ${userAns}</p>
            <p>Correct answer: ${correct}</p>
            <p><em>Explanation: ${q[`Explanation_${lang}`]}</em></p>
          </div>
        `;
      });
    }

    function startTimer(seconds) {
      clearInterval(timerInterval);
      const timer = document.getElementById("timer");
      const tick = () => {
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        timer.textContent = `Time Left: ${min}:${sec.toString().padStart(2, "0")}`;
        if (seconds <= 0) {
          clearInterval(timerInterval);
          submitQuiz();
        }
        seconds--;
      };
      tick();
      timerInterval = setInterval(tick, 1000);
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Site</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .question { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    .hidden { display: none; }
    .lang { float: right; }
    .pagination { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Quiz Site <span class="lang">
    Language:
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="ta">தமிழ்</option>
    </select>
  </span></h1>

  <!-- Topic and Subtopic Selectors -->
  <label for="topicSelect">Topic:</label>
  <select id="topicSelect"></select>

  <label for="subtopicSelect">Subtopic:</label>
  <select id="subtopicSelect"></select>

  <label>Time (minutes):</label>
  <input id="timeLimit" type="number" value="2" min="1" max="30">

  <button onclick="generateQuiz()">Start Quiz</button>

  <div id="timer" style="font-weight: bold; margin-top: 10px;"></div>

  <!-- Quiz Container -->
  <div id="quizContainer" class="hidden"></div>

  <div class="pagination hidden">
    <button onclick="prevQuestion()">Previous</button>
    <button onclick="nextQuestion()">Next</button>
    <button onclick="submitQuiz()">Submit</button>
  </div>

  <div id="scoreContainer"></div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vXYZ/pub?output=csv"; // Replace with yours
    let quizData = [];
    let currentLang = "en";
    let currentQ = 0;
    let currentSet = [];
    let timerInterval;

    fetch(sheetURL)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").map(r => r.split(","));
        const headers = rows[0];
        quizData = rows.slice(1).map(row => {
          let obj = {};
          headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
          return obj;
        });
        populateTopics();
      });

    document.getElementById("languageSelect").addEventListener("change", e => {
      currentLang = e.target.value;
      generateQuiz(); // Reload content in selected language
    });

    function populateTopics() {
      const topicSelect = document.getElementById("topicSelect");
      const topics = new Set(quizData.map(q => q.Topic));
      topics.forEach(topic => {
        const opt = document.createElement("option");
        opt.value = topic;
        opt.textContent = topic;
        topicSelect.appendChild(opt);
      });
      topicSelect.addEventListener("change", populateSubtopics);
      populateSubtopics();
    }

    function populateSubtopics() {
      const topic = document.getElementById("topicSelect").value;
      const subSelect = document.getElementById("subtopicSelect");
      subSelect.innerHTML = "";
      const subtopics = new Set(quizData.filter(q => q.Topic === topic).map(q => q.Subtopic));
      subtopics.forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subSelect.appendChild(opt);
      });
    }

    function generateQuiz() {
      const topic = document.getElementById("topicSelect").value;
      const subtopic = document.getElementById("subtopicSelect").value;
      currentSet = quizData.filter(q => q.Topic === topic && q.Subtopic === subtopic);

      if (currentSet.length === 0) return alert("No questions found!");

      currentQ = 0;
      showQuestion();
      document.querySelector(".pagination").classList.remove("hidden");
      document.getElementById("quizContainer").classList.remove("hidden");

      // Start Timer
      const mins = parseInt(document.getElementById("timeLimit").value);
      startTimer(mins * 60);
    }

    function showQuestion() {
      const q = currentSet[currentQ];
      const lang = currentLang;
      const div = document.getElementById("quizContainer");
      div.innerHTML = `
        <div class="question">
          <p><strong>Q${currentQ + 1}: ${q[`Question_${lang}`]}</strong></p>
          <label><input type="radio" name="q" value="A"> A. ${q[`OptionA_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="B"> B. ${q[`OptionB_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="C"> C. ${q[`OptionC_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="D"> D. ${q[`OptionD_${lang}`]}</label><br>
          <div class="explanation hidden" id="exp"><em>${q[`Explanation_${lang}`]}</em></div>
        </div>
      `;
    }

    function nextQuestion() {
      if (currentQ < currentSet.length - 1) {
        saveAnswer();
        currentQ++;
        showQuestion();
      }
    }

    function prevQuestion() {
      if (currentQ > 0) {
        saveAnswer();
        currentQ--;
        showQuestion();
      }
    }

    const answers = {};

    function saveAnswer() {
      const selected = document.querySelector(`input[name="q"]:checked`);
      if (selected) answers[currentQ] = selected.value;
    }

    function submitQuiz() {
      saveAnswer();
      clearInterval(timerInterval);
      let score = 0;
      currentSet.forEach((q, i) => {
        if (answers[i] === q.Answer) score++;
      });
      const total = currentSet.length;
      document.getElementById("scoreContainer").innerHTML =
        `<h3>Score: ${score} / ${total}</h3>`;
      showExplanations();
    }

    function showExplanations() {
      const div = document.getElementById("quizContainer");
      div.innerHTML = "";
      currentSet.forEach((q, i) => {
        const lang = currentLang;
        const userAns = answers[i] || "Not Answered";
        const correct = q.Answer;
        const color = userAns === correct ? "#c8e6c9" : "#ffcdd2";
        div.innerHTML += `
          <div class="question" style="background-color:${color};">
            <p><strong>Q${i + 1}: ${q[`Question_${lang}`]}</strong></p>
            <p>Your answer: ${userAns}</p>
            <p>Correct answer: ${correct}</p>
            <p><em>Explanation: ${q[`Explanation_${lang}`]}</em></p>
          </div>
        `;
      });
    }

    function startTimer(seconds) {
      clearInterval(timerInterval);
      const timer = document.getElementById("timer");
      const tick = () => {
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        timer.textContent = `Time Left: ${min}:${sec.toString().padStart(2, "0")}`;
        if (seconds <= 0) {
          clearInterval(timerInterval);
          submitQuiz();
        }
        seconds--;
      };
      tick();
      timerInterval = setInterval(tick, 1000);
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Site</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .question { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    .hidden { display: none; }
    .lang { float: right; }
    .pagination { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Quiz Site <span class="lang">
    Language:
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="ta">தமிழ்</option>
    </select>
  </span></h1>

  <!-- Topic and Subtopic Selectors -->
  <label for="topicSelect">Topic:</label>
  <select id="topicSelect"></select>

  <label for="subtopicSelect">Subtopic:</label>
  <select id="subtopicSelect"></select>

  <label>Time (minutes):</label>
  <input id="timeLimit" type="number" value="2" min="1" max="30">

  <button onclick="generateQuiz()">Start Quiz</button>

  <div id="timer" style="font-weight: bold; margin-top: 10px;"></div>

  <!-- Quiz Container -->
  <div id="quizContainer" class="hidden"></div>

  <div class="pagination hidden">
    <button onclick="prevQuestion()">Previous</button>
    <button onclick="nextQuestion()">Next</button>
    <button onclick="submitQuiz()">Submit</button>
  </div>

  <div id="scoreContainer"></div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vXYZ/pub?output=csv"; // Replace with yours
    let quizData = [];
    let currentLang = "en";
    let currentQ = 0;
    let currentSet = [];
    let timerInterval;

    fetch(sheetURL)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").map(r => r.split(","));
        const headers = rows[0];
        quizData = rows.slice(1).map(row => {
          let obj = {};
          headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
          return obj;
        });
        populateTopics();
      });

    document.getElementById("languageSelect").addEventListener("change", e => {
      currentLang = e.target.value;
      generateQuiz(); // Reload content in selected language
    });

    function populateTopics() {
      const topicSelect = document.getElementById("topicSelect");
      const topics = new Set(quizData.map(q => q.Topic));
      topics.forEach(topic => {
        const opt = document.createElement("option");
        opt.value = topic;
        opt.textContent = topic;
        topicSelect.appendChild(opt);
      });
      topicSelect.addEventListener("change", populateSubtopics);
      populateSubtopics();
    }

    function populateSubtopics() {
      const topic = document.getElementById("topicSelect").value;
      const subSelect = document.getElementById("subtopicSelect");
      subSelect.innerHTML = "";
      const subtopics = new Set(quizData.filter(q => q.Topic === topic).map(q => q.Subtopic));
      subtopics.forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subSelect.appendChild(opt);
      });
    }

    function generateQuiz() {
      const topic = document.getElementById("topicSelect").value;
      const subtopic = document.getElementById("subtopicSelect").value;
      currentSet = quizData.filter(q => q.Topic === topic && q.Subtopic === subtopic);

      if (currentSet.length === 0) return alert("No questions found!");

      currentQ = 0;
      showQuestion();
      document.querySelector(".pagination").classList.remove("hidden");
      document.getElementById("quizContainer").classList.remove("hidden");

      // Start Timer
      const mins = parseInt(document.getElementById("timeLimit").value);
      startTimer(mins * 60);
    }

    function showQuestion() {
      const q = currentSet[currentQ];
      const lang = currentLang;
      const div = document.getElementById("quizContainer");
      div.innerHTML = `
        <div class="question">
          <p><strong>Q${currentQ + 1}: ${q[`Question_${lang}`]}</strong></p>
          <label><input type="radio" name="q" value="A"> A. ${q[`OptionA_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="B"> B. ${q[`OptionB_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="C"> C. ${q[`OptionC_${lang}`]}</label><br>
          <label><input type="radio" name="q" value="D"> D. ${q[`OptionD_${lang}`]}</label><br>
          <div class="explanation hidden" id="exp"><em>${q[`Explanation_${lang}`]}</em></div>
        </div>
      `;
    }

    function nextQuestion() {
      if (currentQ < currentSet.length - 1) {
        saveAnswer();
        currentQ++;
        showQuestion();
      }
    }

    function prevQuestion() {
      if (currentQ > 0) {
        saveAnswer();
        currentQ--;
        showQuestion();
      }
    }

    const answers = {};

    function saveAnswer() {
      const selected = document.querySelector(`input[name="q"]:checked`);
      if (selected) answers[currentQ] = selected.value;
    }

    function submitQuiz() {
      saveAnswer();
      clearInterval(timerInterval);
      let score = 0;
      currentSet.forEach((q, i) => {
        if (answers[i] === q.Answer) score++;
      });
      const total = currentSet.length;
      document.getElementById("scoreContainer").innerHTML =
        `<h3>Score: ${score} / ${total}</h3>`;
      showExplanations();
    }

    function showExplanations() {
      const div = document.getElementById("quizContainer");
      div.innerHTML = "";
      currentSet.forEach((q, i) => {
        const lang = currentLang;
        const userAns = answers[i] || "Not Answered";
        const correct = q.Answer;
        const color = userAns === correct ? "#c8e6c9" : "#ffcdd2";
        div.innerHTML += `
          <div class="question" style="background-color:${color};">
            <p><strong>Q${i + 1}: ${q[`Question_${lang}`]}</strong></p>
            <p>Your answer: ${userAns}</p>
            <p>Correct answer: ${correct}</p>
            <p><em>Explanation: ${q[`Explanation_${lang}`]}</em></p>
          </div>
        `;
      });
    }

    function startTimer(seconds) {
      clearInterval(timerInterval);
      const timer = document.getElementById("timer");
      const tick = () => {
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        timer.textContent = `Time Left: ${min}:${sec.toString().padStart(2, "0")}`;
        if (seconds <= 0) {
          clearInterval(timerInterval);
          submitQuiz();
        }
        seconds--;
      };
      tick();
      timerInterval = setInterval(tick, 1000);
    }
  </script>
</body>
</html>